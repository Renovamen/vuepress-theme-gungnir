---
layout: post
title: BOCD
subtitle: "Bayesian Online Changepoint Detection"
author: "Renovamen"
date: 2020-08-22
header_img: /img/in-post/2020-08-22/header.jpg
catalog: true
tags:
  - Machine Learning
  - Math
  - Bayesian
---


ç»™å®šä¸€ä¸ªæ•°æ®åºåˆ—ï¼Œåœ¨æŸä¸ªæ—¶é—´ç‚¹ï¼Œæ•°æ®çš„æŸä¸ªï¼ˆæˆ–æŸäº›ï¼‰å‚æ•°å¯èƒ½ç”±äºç³»ç»Ÿæ€§å› ç´ ï¼ˆè€Œéå¶ç„¶æ€§å› ç´ ï¼‰è€Œçªç„¶å‘ç”Ÿå˜åŒ–ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶é—´ç‚¹è¢«ç§°ä¸º**å˜ç‚¹**ï¼ˆchangepointï¼‰ã€‚<!-- more -->**å˜ç‚¹æ£€æµ‹**ï¼ˆchangepoint detectionï¼‰å°±æ˜¯è¦ä¼°è®¡å‡ºå˜ç‚¹çš„ä½ç½®ã€‚

æœ¬æ–‡ä¸»è¦æ‰“ç®—ç†ä¸€ä¸‹è¿™ç¯‡è®ºæ–‡ï¼š

**Bayesian Online Changepoint Detection.** *Ryan Prescott Adams and David J.C. MacKay.* arXiv 2007. [[Paper]](https://arxiv.org/pdf/0710.3742.pdf)

ç¿»è¯‘è¿‡æ¥å¤§æ¦‚æ˜¯è´å¶æ–¯åœ¨çº¿å˜ç‚¹æ£€æµ‹ï¼Ÿâ€œonlineâ€è¿™ä¸ªè¯æŒ‡æ£€æµ‹å˜ç‚¹æ—¶åªèƒ½åˆ©ç”¨å½“å‰å·²ç»è§‚æµ‹åˆ°çš„æ•°æ®ï¼Œä¸èƒ½ç”¨æœªæ¥æ•°æ®ã€‚è€Œå¾ˆå¤š offline çš„æ–¹æ³•æ˜¯å¯ä»¥æ‹¿æ‰€æœ‰çš„æ•°æ®æ¥åšæ£€æµ‹çš„ã€‚

æœ¬æ–‡å¾ˆå¤§ç¨‹åº¦ä¸Šï¼ˆåˆï¼‰~~æŠ„~~å‚è€ƒäº†ä¸€ç¯‡è®² BOCD è®²å¾—éå¸¸æ¸…æ¥šçš„åšå®¢ï¼š

[**Bayesian Online Changepoint Detection**](http://gregorygundersen.com/blog/2019/08/13/bocd/) (Gregory Gundersen)


## é—®é¢˜å®šä¹‰

å‡è®¾æœ‰ä¸€ä¸ªè§‚æµ‹åºåˆ— $x_1, x_2, \dots, x_T \in \Reals^d$ï¼Œæˆ‘ä»¬ç”¨ $x_{a:b}$ æ¥è¡¨ç¤º $x_a, x_{a+1}, \dots x_b$ã€‚$x_{1:T}$ å¯ä»¥è¢«åˆ’åˆ†æˆä¸€äº›ä¸é‡å çš„ [product partitions](https://projecteuclid.org/download/pdf_1/euclid.aos/1176348521)ï¼Œå³æ¯ä¸ª partition ä¸­çš„æ•°æ®ç‚¹éƒ½æ˜¯ i.i.dï¼ˆç‹¬ç«‹åŒåˆ†å¸ƒï¼‰çš„ï¼Œéƒ½æœä»å‚æ•°ä¸º $\theta_p$ çš„åˆ†å¸ƒ $p(x_t \mid \theta_p)$ï¼Œæ¯ä¸ª partition çš„å‚æ•° $\theta_p \thicksim p(\phi)$ ä¹Ÿæ˜¯ i.i.d çš„ï¼š

<img src="/img/in-post/2020-08-22/product-partitions.png" width="6500px" alt="product partitions" />

è€Œ BOCD ä¼šä¼°è®¡å½“å‰æ—¶åˆ»çš„ run lengthï¼ˆè·ç¦»ä¸Šä¸€ä¸ªå˜ç‚¹å·²ç»è¿‡äº†å¤šå°‘æ—¶åˆ»ï¼‰çš„åéªŒåˆ†å¸ƒ $p(r_t \mid x_{1:t})$ï¼Œ$t$ æ—¶åˆ»çš„ run length ä¸º $r_t$ã€‚æ˜¾ç„¶ $r_t$ åªå¯èƒ½æœ‰ä¸¤ç§æƒ…å†µï¼š

$$
x = 
\begin{cases}
   0 &t \text{ æ—¶åˆ»æ˜¯å˜ç‚¹} \\
   r_{t-1} + 1 &t \text{ æ—¶åˆ»ä¸æ˜¯å˜ç‚¹}
\end{cases}
$$

é‚£ä¹ˆä¸€ä¸ªå¯èƒ½çš„ $r_t$ éš $t$ çš„å˜åŒ–å›¾å¦‚ä¸‹ï¼ˆ$r_t = 0$ çš„æ—¶åˆ»ï¼ˆ$t=5, 11$ï¼‰ä¸ºå˜ç‚¹ï¼‰ï¼š

<img src="/img/in-post/2020-08-22/run_length.png" width="500px" alt="run length" />

é™¤äº† $p(r_t \mid x_{1:t})$ ä»¥å¤–ï¼ŒBOCD è¿˜ä¼šä¼°è®¡ $p(x_{t+1} \mid x_{1:t})$ï¼Œè¿™æ ·å°±èƒ½æ—¢é¢„æµ‹å˜ç‚¹ï¼ˆrun lenghtï¼‰ï¼Œåˆé¢„æµ‹ä¸‹ä¸€ä¸ªæ•°æ®ç‚¹çš„å€¼äº†ã€‚ä¸è¿‡å¦‚æœå•çº¯åªæ±‚å˜ç‚¹çš„è¯ï¼Œ$p(x_{t+1} \mid x_{1:t})$ æ˜¯æ²¡å¿…è¦ç®—çš„ã€‚


## ä¸€ä¸ªé€’æ¨å¼

å¦‚æœä¸æƒ³çœ‹æ¨å¯¼è¿‡ç¨‹ï¼Œå¯ä»¥ç›´æ¥[è·³åˆ°](#é€’æ¨æµç¨‹)è¿™é‡Œçœ‹ç»“æœã€‚

### ä¸‹ä¸€ä¸ªæ•°æ®ç‚¹çš„åˆ†å¸ƒ

$p(x_{t+1} \mid x_{1:t})$ å¯ä»¥ç”±ç»™å®š $r_t$ æ—¶ $x_{t+1}$ çš„è¾¹ç¼˜åˆ†å¸ƒç®—å‡ºæ¥ï¼š

$$
\begin{aligned}
    p(x_{t+1} \mid x_{1:t})&= \sum_{r_t} p(x_{t+1}, r_t \mid x_{1:t}) & \text{(è¾¹ç¼˜æ¦‚ç‡å…¬å¼)} \\
        &= \sum_{r_t} p(x_{t+1} \mid r_t, x_{1:t}) p(r_t \mid x_{1:t}) & \text{(é“¾å¼æ³•åˆ™)}\\
        &= \sum_{r = 0}^t p(x_{t+1} \mid r_t = r, x_{(t - r):t}) p(r_t \mid x_{1:t}) & \text{(å‡è®¾ 1)}\\
        &= \sum_{r_t} p(x_{t+1} \mid r_t, x_t^{(r)}) p(r_t \mid x_{1:t}) & 
\end{aligned}
$$

å…¶ä¸­ $x_t^{(r)} = x_{(t - r):t}$ ä¸º run length $= r$ æ—¶å½“å‰ partion çš„è§‚æµ‹ç‚¹é›†åˆï¼Œå› ä¸ºæˆ‘ä»¬åªä¼šç”¨å½“å‰ partion çš„æ•°æ®æ¥é¢„æµ‹ $x_{t+1}$ çš„åˆ†å¸ƒï¼ˆå‡è®¾ 1ï¼‰ã€‚å› ä¸º $r_t$ å¯èƒ½ä¸º 0ï¼Œæ‰€ä»¥ $x_t^{(r)}$ å¯èƒ½ä¸ºç©ºé›†ã€‚


### run length çš„åˆ†å¸ƒ

é‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦è®¡ç®— run length çš„åˆ†å¸ƒ $p(r_t \mid x_{1:t})$ï¼š

$$
p(r_t \mid x_{1:t}) = \frac{p(r_t, x_{1:t})}{p(x_{1:t})}
$$

é‚£ä¹ˆæˆ‘ä»¬éœ€è¦ç®—è”åˆæ¦‚ç‡ $p(r_t, x_{1:t})$ï¼š

$$
\begin{aligned}
    p(r_t, x_{1:t})&= \sum_{r_{t-1}} p(r_t, r_{t-1}, x_{1:t}) & \text{(è¾¹ç¼˜æ¦‚ç‡å…¬å¼)} \\
        &= \sum_{r_{t-1}} p(r_t, r_{t-1}, x_{1:t-1}, x_t) & \\
        &= \sum_{r_{t-1}} p(r_t, x_t \mid r_{t-1}, x_{1:t-1}) p(r_{t-1}, x_{1:t-1}) & \text{(é“¾å¼æ³•åˆ™)} \\
        &= \sum_{r_{t-1}} p(x_t \mid \cancel{r_t}, r_{t-1}, x_{1:t-1}) p(r_t \mid r_{t-1}, \cancel{x_{1:t-1}}) p(r_{t-1}, x_{1:t-1}) & \text{(é“¾å¼æ³•åˆ™)} \\
        &= \sum_{r_{t-1}} p(x_t \mid r_{t-1}, x^{(r)}) p(r_t \mid r_{t-1}) p(r_{t-1}, x_{1:t-1}) & \text{(å‡è®¾ 1, 2)}
\end{aligned}
$$

æœ€åä¸€æ­¥èƒ½æˆç«‹ä¾èµ–äºä»¥ä¸‹ä¸¤ä¸ªå‡è®¾ï¼š

1. å‰é¢æåˆ°çš„å‡è®¾ 1ï¼Œå³åªç”¨å½“å‰ partion çš„æ•°æ®æ¥é¢„æµ‹ $x_t$ çš„åˆ†å¸ƒï¼š

    $$
    p(x_t \mid r_t, r_{t-1}, x_{1:t-1}) = p(x_t \mid r_{t-1}, x_{t-1}^{(r)}) \tag{\text{å‡è®¾ 1}}
    $$

    å› ä¸º $r_t$ åªä¾èµ–äº $r_{t-1}$ï¼ˆå‡è®¾ 2ï¼‰ï¼Œæ‰€ä»¥è¿™é‡Œ $r_t$ ä¹Ÿå¯ä»¥çœæ‰ã€‚

2. $r_t$ åªä¾èµ–äº $r_{t-1}$ã€‚å³ç»™å®š $r_{t-1}$ï¼Œ$r_t$ å¯¹å…¶ä»–æ‰€æœ‰å˜é‡éƒ½æ¡ä»¶ç‹¬ç«‹ï¼š

    $$
    p(r_t \mid r_{t-1}, x_{1:t-1}) = p(r_t \mid r_{t-1}) \tag{\text{å‡è®¾ 2}}
    $$


### é€’æ¨æµç¨‹

å¯ä»¥çœ‹åˆ°æ±‚ $p(x_{t+1} \mid x_{1:t})$ çš„è¿‡ç¨‹æ˜¯ä¸€ä¸ªé€’æ¨çš„è¿‡ç¨‹ã€‚åœ¨ $t$ æ—¶åˆ»ï¼Œ$p(r_{t-1}, x_{1:t-1})$ å·²ç»è®¡ç®—å‡ºæ¥äº†ï¼Œç°åœ¨æˆ‘ä»¬è¦æ±‚ $p(x_{t+1} \mid r_t, x_t^{(r)})$ï¼Œé‚£ä¹ˆè®¡ç®—æµç¨‹ä¸ºï¼š

1. è®¡ç®—å˜ç‚¹çš„å…ˆéªŒ $p(r_t \mid r_{t-1})$

2. è®¡ç®— run length $r_t$ çš„åéªŒåˆ†å¸ƒï¼š$p(r_t \mid x_{1:t}) = \frac{p(r_t, x_{1:t})}{p(x_{1:t})}$

    å…¶ä¸­ï¼š

    $$
    p(r_t, x_{1:t}) = \sum_{r_{t-1}} \underbrace{p(x_t \mid r_{t-1}, x_{t-1}^{(r)})}_{\text{UPM}} \underbrace{p(r_t \mid r_{t-1})}_{\text{å˜ç‚¹å…ˆéªŒ}} \underbrace{p(r_{t-1}, x_{1:t-1})}_{\text{å·²æ±‚å¾—çš„ä¿¡æ¯}} \\[1pt]
    $$

3. è®¡ç®—æ–°æ•°æ®ç‚¹çš„åˆ†å¸ƒ $p(x_{t+1} \mid x_{1:t})$ï¼š

    $$
    p(x_{t+1} \mid x_{1:t}) = \sum_{r_t} \underbrace{p(x_{t+1} \mid r_t, x_t^{(r)})}_{\text{UPM}} \underbrace{p(r_t \mid x_{1:t})}_{\text{å·²æ±‚å¾—çš„ä¿¡æ¯}} \\[1pt]
    $$

å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬è¿˜éœ€è¦è®¡ç®—çš„ä¸¤ä¸ªå¼å­æ˜¯ï¼š

- $p(x_t \mid r_{t-1}, x_{t-1}^{(r)})$ å’Œ $p(x_{t+1} \mid r_t, x_t^{(r)})$ï¼šä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘ä»¬æŒ‰ç…§æœ¬æ–‡~~æŠ„~~å‚è€ƒçš„[åšå®¢](http://gregorygundersen.com/blog/2019/08/13/bocd/)çš„å«æ³•ï¼ŒæŠŠå®ƒç§°ä¸º Underlying Probabilistic Modelï¼ˆUPMï¼‰ï¼Œå®ƒçš„æ±‚æ³•å°†åœ¨[è¿™ä¸€èŠ‚](#upm)è§£é‡Š

- å˜ç‚¹å…ˆéªŒ $p(r_t \mid r_{t-1})$ï¼šå®ƒçš„æ±‚æ³•å°†åœ¨[è¿™ä¸€èŠ‚](#å˜ç‚¹å…ˆéªŒ)è§£é‡Š

è¿™å¼ å›¾è¯´æ˜äº†è¿™ä¸ªé€’æ¨æµç¨‹ï¼š

<img src="/img/in-post/2020-08-22/message_passing.png" width="400px" alt="message passing" />

<p class="desc">å›¾ç‰‡æ¥æºï¼š<a href="http://gregorygundersen.com/blog/2019/08/13/bocd/" target="_blank">Blog: Bayesian Online Changepoint Detection</a></p>


å½“ç„¶ï¼Œåœ¨å¼€å§‹è¿™ä¸ªé€’æ¨æµç¨‹ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨å®šä¹‰åˆå§‹å€¼ $p(r_0, x = \empty) = p(r_0)$ï¼Œå®šä¹‰æ–¹å¼å°†åœ¨[è¿™ä¸€èŠ‚](#é€’æ¨åˆå§‹å€¼)è§£é‡Šã€‚


## å˜ç‚¹å…ˆéªŒ

è´å¶æ–¯æ–¹æ³•çš„ç‰¹ç‚¹å°±æ˜¯èƒ½åˆ©ç”¨å…ˆéªŒä¿¡æ¯ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æŠŠæˆ‘ä»¬å¯¹å˜ç‚¹çš„å…ˆéªŒä¼°è®¡é€šè¿‡ hazard function å¡è¿›æ¨¡å‹é‡Œã€‚

æˆ‘ä»¬å‡è®¾ï¼š

$$
p(r_t \mid r_{t-1}) = 
\begin{cases}
   H(r_{t-1} + 1) &\text{if } r_t = 0 \\
   1 - H(r_{t-1} + 1) &\text{if } r_t = r_{t-1} + 1 \\
   0 &\text{otherwise}
\end{cases}
$$

$H(\tau)$ æ˜¯ hazard functionï¼Œæè¿°çš„æ˜¯ä¸ªä½“åœ¨ $\tau$ æ—¶åˆ»æ­»äº¡çš„æ¦‚ç‡ï¼ˆ...ï¼‰ã€‚å½“ç„¶â€œæ­»äº¡â€è¿™ä¸ªè¯å¯ä»¥æ¢æˆåˆ«çš„ä»€ä¹ˆç‰¹æ®Šäº‹ä»¶ï¼Œæ¯”å¦‚åœ¨è¿™é‡Œ $H(\tau)$ æè¿°çš„å°±æ˜¯åœ¨ run length $= \tau$ æ—¶ï¼ˆåœ¨è¿™ä¹‹å‰éƒ½æ²¡å‡ºç°å˜ç‚¹ï¼‰å‡ºç°å˜ç‚¹çš„æ¦‚ç‡ã€‚

### Survival Function

è®¾ $T \geq 0$ æ˜¯ä¸€ä¸ªè¡¨ç¤ºå½“å‰ run length é•¿åº¦çš„éšæœºå˜é‡ã€‚$S(\tau)$ æ˜¯ survival functionï¼Œè¡¨ç¤º run length è¶…è¿‡ $\tau$ çš„æ¦‚ç‡ï¼š

$$
S(\tau) = P(T \geq \tau) = 1 - F(\tau) = \sum_{\tau' = \tau}^\infty f(\tau')
$$

å…¶ä¸­ $F(\tau) = P(T < \tau)$ã€‚$f(\tau)$ è¡¨ç¤ºå½“å‰ run length $= \tau$ çš„æ¦‚ç‡ï¼Œæ˜¯ä¸€ä¸ªæ¦‚ç‡å¯†åº¦å‡½æ•°ã€‚å¯ä»¥çœ‹åˆ°æœ‰ï¼š

$$
f(\tau) = F'(\tau) = -\frac{d S(\tau)}{d \tau}
$$


### Hazard Function

é‚£ä¹ˆç”± hazard function çš„å®šä¹‰ï¼š

$$
\begin{aligned}
    H(\tau) &= \lim_{\Delta \tau \rarr 0} \frac{p(\tau \leq T < \tau + \Delta \tau \mid T \geq \tau)}{\Delta \tau} \\
        &= \lim_{\Delta \tau \rarr 0} \frac{p(\tau \leq T < \tau + \Delta \tau)}{p(T \geq \tau) \Delta \tau} \\
        &= \frac{f(\tau)}{S(\tau)}
\end{aligned}
$$

è¿™é‡Œ $f(\tau)$ æ˜¯æˆ‘ä»¬è‡ªå·±å®šçš„ä¸€ä¸ªå…ˆéªŒã€‚

å½“ $f(\tau)$ æ­£å¥½è¢«å®šä¸ºä¸€ä¸ªæŒ‡æ•°åˆ†å¸ƒï¼ˆæˆ–å‡ ä½•åˆ†å¸ƒï¼ˆç¦»æ•£ï¼‰ï¼‰æ—¶ï¼š

$$
f(\tau) = \lambda e^{- \lambda \tau}
$$

$$
F(\tau) = 1- e^{- \lambda \tau}
$$

$$
S(\tau) = 1- F(\tau) = e^{- \lambda \tau}
$$

æ­¤æ—¶ $H(\tau) = \frac{f(\tau)}{S(\tau)} = \lambda$ æ˜¯ä¸€ä¸ªå¸¸æ•°ï¼ˆä½†è®ºæ–‡é‡Œé¢å†™çš„æ˜¯ $\frac{1}{\lambda}$ï¼Œæˆ‘ä¹Ÿä¸çŸ¥é“æˆ‘å“ªé‡Œæ¨é”™äº†...ï¼‰ã€‚


## é€’æ¨åˆå§‹å€¼

æˆ‘ä»¬éœ€è¦ç»™ $p(r_0)$ èµ‹ä¸€ä¸ªåˆå§‹å€¼ï¼Œåˆ†ä¸ºä¸¤ç§æƒ…å†µï¼š

1. ç¬¬ä¸€ä¸ªè§‚æµ‹åˆ°çš„æ•°æ®ç‚¹ä¹‹å‰ï¼ˆ$t=0$ï¼‰å°±æ˜¯ä¸€ä¸ªå˜ç‚¹ã€‚è®ºæ–‡ä¸­ç»™çš„ä¾‹å­æ˜¯å¯¹æ¸¸æˆæ•°æ®åºåˆ—å»ºæ¨¡ï¼Œæ¸¸æˆå¼€å§‹çš„æ—¶åˆ»ä¸€å®šæ˜¯ä¸ªå˜ç‚¹ã€‚é‚£ä¹ˆæ˜¾ç„¶æœ‰ï¼š

    $$
    p(r_0 = 0) = 1
    $$

    ä½†è¿™ä¸ªå‡è®¾å¹¶ä¸æ€»æ˜¯æˆç«‹ã€‚

2. å‡è®¾æˆ‘ä»¬ç°åœ¨æœ‰æœ€è¿‘ä¸€æ®µæ—¶é—´çš„å†å²æ•°æ®ï¼Œå¹¶ä¸”æˆ‘ä»¬è®¤ä¸ºç¬¬ä¸€ä¸ªå˜ç‚¹ä¼šåœ¨æœªæ¥æŸä¸ªæ—¶åˆ»å‡ºç°ã€‚è®ºæ–‡ç»™çš„ä¾‹å­æ˜¯å¯¹æ°”è±¡æ•°æ®å»ºæ¨¡ã€‚è¿™æ—¶åˆå§‹å€¼ä¸ºå½’ä¸€åŒ–åçš„ survival functionï¼š

    $$
    p(r_0 = \tau) = \frac{1}{Z} \sum_{\tau' = \tau + 1}^\infty f(\tau')
    $$

    å…¶ä¸­ $Z$ æ˜¯ä¸€ä¸ªå½’ä¸€åŒ–å¸¸æ•°ã€‚

## UPM

å¥½çš„é‚£ä¹ˆç°åœ¨ $p(x_{t+1} \mid r_t, x_t^{(r)})$ å°±æ˜¯æœ€åä¸€ä¸ªè¦ç®—çš„ä¸œè¥¿äº†ï¼Œæˆ‘ä»¬æŠŠå®ƒå†™æˆè¾¹ç¼˜åˆ†å¸ƒï¼š

$$
p(x_{t+1} \mid r_t, x_t^{(r)}) = \int \underbrace{p(x_{t+1} \mid \eta)}_{\text{EF model}} \underbrace{p(\eta_t^{(r)} = \eta \mid r_t, x_t^{(r)})}_{\text{EF posterior}} d \eta \\[1pt]
$$

$\eta_t^{(r)}$ è¡¨ç¤ºåœ¨ $t$ æ—¶åˆ» run length $= r$ æ—¶çš„è¶…å‚æ•°ï¼Œç¬¬ä¸€é¡¹çš„æ„ä¹‰æ˜¯ $x$ æœä»å‚æ•°ä¸º $\eta$ çš„**æŒ‡æ•°æ—åˆ†å¸ƒï¼ˆExponential Familyï¼‰**ï¼Œç„¶åå¯¹è¿™ä¸ªæŒ‡æ•°æ—åˆ†å¸ƒå»ºæ¨¡ã€‚ç¬¬äºŒé¡¹æ˜¯ $\eta$ çš„åéªŒã€‚

$\eta$ çš„åéªŒå¹¶ä¸å¥½è®¡ç®—ï¼Œè€Œä¸”è¿™é‡Œè¿˜è¦å¯¹æ¯ä¸ª $\eta$ æ±‚ç§¯åˆ†ï¼Œä¹Ÿä¸å¥½ç®—ã€‚æ‰€ä»¥æˆ‘ä»¬å¾€å¾€å¸Œæœ› $\eta$ çš„å…ˆéªŒè·Ÿå®ƒçš„ä¼¼ç„¶**å…±è½­ï¼ˆconjugateï¼‰**ï¼Œä½¿å¾—å…ˆéªŒä¸åéªŒçš„å½¢å¼ç›¸åŒï¼Œè¿™æ ·å°±èƒ½ç®€åŒ–è®¡ç®—ã€‚


### å…±è½­å…ˆéªŒ

å‡è®¾ $X$ æ˜¯å·²ç»è§‚æµ‹åˆ°çš„æ•°æ®ï¼Œ$\hat{x}$ æ˜¯è¦é¢„æµ‹çš„æ–°æ•°æ®ç‚¹ï¼Œ$\eta$ æ˜¯æ¨¡å‹å‚æ•°ï¼Œ$\alpha$ æ˜¯è¶…å‚æ•°ã€‚é‚£ä¹ˆï¼š

$$
p(\hat{x} \mid X, \alpha) = \int \underbrace{p(\hat{x} \mid \eta)}_{\text{model}} \underbrace{p(\eta \mid X, \alpha)}_{\text{posterior}} d \eta
$$

è¿™é‡Œ $\eta$ çš„å…ˆéªŒè·Ÿå®ƒçš„ä¼¼ç„¶æ˜¯å…±è½­çš„ï¼Œæ‰€ä»¥ $\eta$ çš„åéªŒè·Ÿå®ƒçš„å…ˆéªŒçš„å½¢å¼ç›¸åŒï¼Œåªæ˜¯è¶…å‚æ•°ä¸åŒï¼š

$$
p(\eta \mid X, \alpha) = p(\eta \mid \alpha')
$$

é‚£ä¹ˆæœ‰ï¼š

$$
\begin{aligned}
    p(\hat{x} \mid X, \alpha) &= \int p(\hat{x} \mid \eta) p(\eta \mid X, \alpha) d \eta \\
        &= \int p(\hat{x} \mid \eta) p(\eta \mid \alpha') d \eta \\
        &= p(\hat{x} \mid \alpha')
\end{aligned}
$$

ä¹Ÿå°±æ˜¯è¯´ $\hat{x}$ çš„åéªŒè·Ÿå®ƒçš„å…ˆéªŒçš„å½¢å¼ä¹Ÿæ˜¯ç›¸åŒçš„ã€‚å¦‚æœæˆ‘ä»¬èƒ½ç®—å‡º $\eta$ çš„åéªŒçš„è¶…å‚æ•° $\alpha'$ï¼Œå°±èƒ½åœ¨ä¸ç›´æ¥ç®—åéªŒ $p(\eta \mid X, \alpha)$ ä¹Ÿä¸ç®—ç§¯åˆ†çš„æƒ…å†µä¸‹ç›´æ¥ç®—å‡º $p(\hat{x} \mid X, \alpha)$ã€‚

è€Œå½“ $\eta$ çš„ä¼¼ç„¶æ˜¯æŒ‡æ•°æ—åˆ†å¸ƒæ—¶ï¼Œå°±ä¸€å®šèƒ½å†™å‡ºå…¶å…±è½­å…ˆéªŒåˆ†å¸ƒï¼Œä¸”åéªŒçš„è¶…å‚æ•° $\alpha'$ èƒ½å¤Ÿå¾ˆè½»æ¾çš„æ±‚å‡ºæ¥ã€‚



### æŒ‡æ•°æ—åˆ†å¸ƒ

æŒ‡æ•°æ—æ˜¯ä¸€ç±»åˆ†å¸ƒï¼ŒåŒ…æ‹¬é«˜æ–¯åˆ†å¸ƒã€ä¼¯åŠªåˆ©åˆ†å¸ƒã€äºŒé¡¹åˆ†å¸ƒã€æ³Šæ¾åˆ†å¸ƒã€Beta åˆ†å¸ƒã€Dirichlet åˆ†å¸ƒã€Gamma åˆ†å¸ƒç­‰ä¸€ç³»åˆ—åˆ†å¸ƒã€‚æŒ‡æ•°æ—åˆ†å¸ƒå¯ä»¥å†™ä¸ºç»Ÿä¸€çš„å½¢å¼ï¼š

$$
\begin{aligned}
    p(x \mid \eta) &= h(x) \exp (\eta^\top U(x) - A(\eta)) \\
        &= \frac{1}{\exp(A(\eta))} h(x) \exp (\eta^\top U(x)) \\
        &= g(\eta) h(x) \exp (\eta^\top U(x))
\end{aligned}
$$

å…¶ä¸­ï¼Œ$h(x)$ æ˜¯ underlying measureï¼ˆæ²¡æ‰¾åˆ°å•¥åˆé€‚çš„ç¿»è¯‘ï¼‰ï¼›$U(x)$ æ˜¯å……åˆ†ç»Ÿè®¡é‡ï¼ˆsufficient statisticï¼‰ï¼ŒåŒ…å«æ ·æœ¬é›†åˆçš„æ‰€æœ‰ä¿¡æ¯ï¼Œå¦‚é«˜æ–¯åˆ†å¸ƒä¸­çš„å‡å€¼ $\mu$ å’Œæ–¹å·® $\sigma$ï¼›$g(\eta) = \frac{1}{\exp(A(\eta))}$ æ˜¯æ­£åˆ™å‡½æ•°ï¼ˆnormalizerï¼‰ï¼›$A(\eta)$ æ˜¯å¯¹æ•°æ­£åˆ™å‡½æ•°ï¼ˆlog normalizerï¼‰ï¼Œç”¨äºä¿è¯ï¼š

$$
\frac{1}{\exp(A(\eta))} \int h(x) \exp (\eta^\top U(x)) dx = 1
$$

$A(\eta)$ å« log normalizer è¿™ä¸ªåå­—æ˜¯å› ä¸ºç”±ä¸Šå¼å¯ä»¥æ¨å‡ºï¼š

$$
A(\eta) = \log \int h(x) \exp (\eta^\top U(x)) dx
$$

è·Ÿä¼¼ç„¶ $p(x \mid \eta)$ å…±è½­çš„ $\eta$ çš„å…ˆéªŒä¸ºï¼š

$$
p(\eta \mid \chi, \nu) = f(\chi, \nu) g(\eta)^{\nu} \exp ( \eta^{\top} \chi )
$$

å…¶ä¸­ $\chi, \nu$ æ˜¯è¶…å‚æ•°ï¼Œ$f(\chi, \nu)$ å–å†³äºæŒ‡æ•°æ—åˆ†å¸ƒçš„å…·ä½“å½¢å¼ã€‚

ç”±[è´å¶æ–¯å…¬å¼](/2020/08/16/bayesian-neural-network/#è´å¶æ–¯ä¼°è®¡)ï¼ŒåéªŒæ­£æ¯”äºä¼¼ç„¶ $\times$ å…ˆéªŒï¼Œæ‰€ä»¥ï¼š

$$
\begin{aligned}
    p(\eta \mid X, \chi, \nu) & \propto p(X \mid \eta) p(\eta \mid \chi, \nu) \\
        & \propto \underbrace{\vphantom{\Bigg|} \left ( \Big ( \prod_{i=1}^N h(x_n) \Big ) g(\eta)^N \exp (\eta^\top \sum_{n=1}^N u(x_n)) \right )}_{\text{ä¼¼ç„¶}} \underbrace{\vphantom{\Bigg|} \Big ( f(\chi, \nu) g(\eta)^{\nu} \exp ( \eta^{\top} \chi ) \Big )}_{\text{å…ˆéªŒ}} \\
        & \propto \Big ( \prod_{i=1}^N h(x_n) \Big ) f(\chi, \nu) g(\eta)^{N + \nu} \exp \Big (\eta^\top \sum_{n=1}^N u(x_n) + \eta^{\top} \chi \Big ) \\
        & \propto g(\eta)^{N + \nu} \exp \Big (\eta^\top \sum_{n=1}^N u(x_n) + \eta^{\top} \chi \Big )
\end{aligned}
$$

æœ€åä¸€æ­¥æ˜¯å› ä¸º $\Big ( \prod_{i=1}^N h(x_n) \Big ) f(\chi, \nu)$ æ˜¯è·Ÿ $\eta$ æ— å…³çš„ï¼Œæ‰€ä»¥å¯ä»¥å»æ‰ã€‚

å¯ä»¥çœ‹åˆ°åéªŒ $p(\eta \mid X, \chi, \nu)$ è·Ÿå…ˆéªŒ $p(\eta \mid \chi, \nu)$ çš„å½¢å¼æ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯è¶…å‚æ•°ä¸Šæœ‰åŒºåˆ«ï¼š

$$
\nu' = \nu_{\text{prior}} + N
$$

$$
\chi' = \chi_{\text{prior}} + \sum_{n=1}^N u(x_n)
$$

æ‰€ä»¥å¦‚æœä¼¼ç„¶æ˜¯æŒ‡æ•°æ—åˆ†å¸ƒï¼Œé‚£ä¹ˆåœ¨å…ˆéªŒçš„è¶…å‚æ•°ä¸ŠåŠ ä¸€ä¸ªé¡¹å°±å¯ä»¥å¾—åˆ°åéªŒçš„è¶…å‚æ•°ï¼Œæ˜¯ç§å¾ˆç®€ä¾¿çš„æ–¹æ³•ã€‚


### åˆä¸€ä¸ªé€’æ¨

ç°åœ¨ $p(x_{t+1} \mid r_t, x_t^{(r)})$ å¯ä»¥è¢«è¡¨ç¤ºæˆ $p(x_{t+1} \mid \nu_t^{(r)}, \chi_t^{(r)})$ï¼Œç›¸å½“äºæˆ‘ä»¬çš„ç›®æ ‡å˜æˆäº†æ±‚ $\nu_t^{(r)}$ å’Œ $\chi_t^{(r)}$ï¼Œè€Œä¸”è¦å¯¹æ¯ä¸€ä¸ªå¯èƒ½çš„ $r_t = r \leq t$ï¼ˆå³ $X = x_t^{(r)} = x_{(t-r): t}$ï¼‰éƒ½ç®—ä¸€ä¸ª $\nu_t^{(r)}$ å’Œ $\chi_t^{(r)}$ï¼š

$$
\nu_t^{(r)} = \nu_{t-1}^{(r-1)} + 1
$$

$$
\chi_t^{(r)} = \chi_{t-1}^{(r-1)} + u(x_t)
$$

$$
\nu_t^0 = \nu_{\text{prior}}
$$

$$
\chi_t^0 = \chi_{\text{prior}}
$$

è¿™ä¸ªé€’æ¨çš„è¿‡ç¨‹å¤§æ¦‚æ˜¯è¿™æ ·ï¼š

<img src="/img/in-post/2020-08-22/parameter_updates.png" width="450px" alt="parameter updates" />

<p class="desc">å›¾ç‰‡æ¥æºï¼š<a href="http://gregorygundersen.com/blog/2019/08/13/bocd/" target="_blank">Blog: Bayesian Online Changepoint Detection</a></p>



## å®Œæ•´ç®—æ³•

æœ‰ç©ºå†è¯´ï¼Œæˆ‘å…ˆæ‘¸ä¸‹ğŸŸ...


## å‚è€ƒ

- [Bayesian Online Changepoint Detection.](https://arxiv.org/pdf/0710.3742.pdf) *Ryan Prescott Adams and David J.C. MacKay.* arXiv 2007. (original paper)

- [Bayesian Online Changepoint Detection](http://gregorygundersen.com/blog/2019/08/13/bocd/) (a blog by Gregory Gundersen)

- [Bayesian online change point detection â€” An intuitive understanding](https://medium.com/scientya/bayesian-online-change-point-detection-an-intuitive-understanding-b2d2b9dc165b) (a blog on Medium)

- [Survival Analysis: Techniques for Censored and Truncated Data.](https://books.google.nl/books?hl=zh-CN&lr=&id=aO7xBwAAQBAJ&oi=fnd&pg=PR1&ots=8jU8XPsdJP&sig=BQuvnchfXc587ejQr1dpJaCFQOw#v=onepage&q&f=false) *John P. Klein and Melvin L. Moeschberger.* Springer Science & Business Media, 2006.

- [æŒ‡æ•°æ—åˆ†å¸ƒ](https://www.yuque.com/books/share/f4031f65-70c1-4909-ba01-c47c31398466/ioggkd)